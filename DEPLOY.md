# –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ Docker

## üê≥ Docker (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cp env.example .env
nano .env  # –£–∫–∞–∂–∏—Ç–µ TELEGRAM_BOT_TOKEN

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ
docker-compose --env-file .env up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

- **API –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (`parkinson_api`) - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 5000
- **Bot –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä** (`parkinson_bot`) - Telegram –±–æ—Ç

–û–±–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–±—â–∏–π —Ç–æ–º –¥–ª—è `results.json` –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `results/`.

### –û—Ç–ª–∞–¥–∫–∞

**–í—Ö–æ–¥ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:**
```bash
docker exec -it parkinson_api bash
docker exec -it parkinson_bot bash
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
docker-compose ps
docker-compose logs api
docker-compose logs bot
```

---

## üåê –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥–µ (Production)

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### 1. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

- **–û–°**: Linux (Ubuntu 20.04+ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- **Docker** –∏ **docker-compose** —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- **–ú–∏–Ω–∏–º—É–º**: 2GB RAM, 1 CPU, 10GB –¥–∏—Å–∫–∞
- **–ü–æ—Ä—Ç—ã**: 5000 (–∏–ª–∏ –¥—Ä—É–≥–æ–π, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç

### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
2. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `env.example`:

```bash
cp env.example .env
nano .env
```

3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```env
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞
API_URL=https://yourdomain.com
API_PORT=5000
DEBUG=False
FLASK_ENV=production
```

**–í–∞–∂–Ω–æ**: `API_URL` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–Ω–µ—à–Ω–∏–º URL –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (—Å –¥–æ–º–µ–Ω–æ–º –∏–ª–∏ IP), —á—Ç–æ–±—ã –±–æ—Ç –º–æ–≥ –∫ –Ω–µ–º—É –æ–±—Ä–∞—â–∞—Ç—å—Å—è.

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

```bash
mkdir -p data/results
touch data/results.json
chmod 666 data/results.json
```

## –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
docker-compose -f docker-compose.prod.yml --env-file .env up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose -f docker-compose.prod.yml logs -f

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose -f docker-compose.prod.yml down
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –° Nginx Reverse Proxy

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Nginx:

```bash
sudo apt update
sudo apt install nginx
```

2. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx `/etc/nginx/sites-available/parkinson`:

```nginx
server {
    listen 80;
    # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: server_name _;
    # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ –¥–æ–º–µ–Ω—É –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ: server_name yourdomain.com;
    server_name _;  # –ü—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –ª—é–±–æ–≥–æ –¥–æ–º–µ–Ω–∞/IP
    
    # –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –∑–∞–≥—Ä—É–∂–∞–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤ (–¥–ª—è –∞—É–¥–∏–æ)
    client_max_body_size 50M;
    
    location / {
        proxy_pass http://localhost:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—É–¥–∏–æ
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
        
        # –£–±–∏—Ä–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –±—É—Ñ–µ—Ä–∞
        proxy_buffering off;
        proxy_request_buffering off;
    }
}
```

3. –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```bash
sudo ln -s /etc/nginx/sites-available/parkinson /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

4. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:

```env
API_URL=https://yourdomain.com
```

5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker-compose -f docker-compose.prod.yml --env-file .env up -d
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –° SSL (Let's Encrypt)

1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot:

```bash
sudo apt install certbot python3-certbot-nginx
```

2. –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:

```bash
sudo certbot --nginx -d yourdomain.com
```

3. –û–±–Ω–æ–≤–∏—Ç–µ `.env`:

```env
API_URL=https://yourdomain.com
```

4. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:

```bash
docker-compose -f docker-compose.prod.yml --env-file .env restart
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ API**:
```bash
curl http://yourdomain.com/api/stats
```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**:
–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://yourdomain.com`

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–æ—Ç–∞**:
–û—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É –≤ Telegram

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose -f docker-compose.prod.yml logs -f

# –¢–æ–ª—å–∫–æ API
docker-compose -f docker-compose.prod.yml logs -f api

# –¢–æ–ª—å–∫–æ –±–æ—Ç
docker-compose -f docker-compose.prod.yml logs -f bot
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

```bash
docker-compose -f docker-compose.prod.yml ps
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤

```bash
docker stats
```

## –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –±—ç–∫–∞–ø

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç `backup.sh`:

```bash
#!/bin/bash
BACKUP_DIR="/backups/parkinson"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR
cp data/results.json $BACKUP_DIR/results_$DATE.json
# –•—Ä–∞–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π
find $BACKUP_DIR -name "results_*.json" -mtime +30 -delete
```

–î–æ–±–∞–≤—å—Ç–µ –≤ crontab:

```bash
crontab -e
# –ë—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:00
0 2 * * * /path/to/backup.sh
```

## –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose -f docker-compose.prod.yml down

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ (git pull –∏ —Ç.–¥.)

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.prod.yml --env-file .env up -d --build
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ 403 Forbidden –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 80

–ï—Å–ª–∏ –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –ø–æ –≤–Ω–µ—à–Ω–µ–º—É IP –Ω–∞ –ø–æ—Ä—Ç 80 –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—à–∏–±–∫—É 403 Forbidden, –∞ –Ω–∞ –ø–æ—Ä—Ç 5000 –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ nginx.

**–†–µ—à–µ–Ω–∏–µ:**

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx:
```bash
sudo cat /etc/nginx/sites-available/parkinson
```

2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `server_name _;` (–¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP) –≤–º–µ—Å—Ç–æ `server_name yourdomain.com;`:
```nginx
server {
    listen 80;
    server_name _;  # –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø–æ IP
    # ...
}
```

3. –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥–æ–º–µ–Ω, –Ω–æ —Ö–æ—Ç–∏—Ç–µ —Ç–∞–∫–∂–µ —Ä–∞–∑—Ä–µ—à–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ IP, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```nginx
server {
    listen 80;
    server_name _ yourdomain.com;  # –ò IP, –∏ –¥–æ–º–µ–Ω
    # ...
}
```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ nginx:
```bash
sudo nginx -t
sudo systemctl reload nginx
```

5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ nginx –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```bash
sudo tail -f /var/log/nginx/error.log
```

### –ë–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ API

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `API_URL` –≤ `.env` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤–Ω–µ—à–Ω–∏–π URL
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç –æ—Ç–∫—Ä—ã—Ç –≤ firewall
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞: `docker-compose logs bot`

### API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `sudo ufw status`
- –û—Ç–∫—Ä–æ–π—Ç–µ –ø–æ—Ä—Ç: `sudo ufw allow 5000/tcp`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—â–µ–Ω: `docker ps`

### –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∞—É–¥–∏–æ

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `docker-compose logs api`
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤ –æ–±—Ä–∞–∑–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `data/`

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

‚ö†Ô∏è **–ù–ò–ö–û–ì–î–ê –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –≤ –∫–æ–¥–µ!**

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Ñ–∞–π–ª `.env`
- –§–∞–π–ª `.env` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω –∏–∑ Git
- –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Ç–∑–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ `/revoke` –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω

2. **–û–±–Ω–æ–≤–∏—Ç–µ —Ç–æ–∫–µ–Ω –≤–µ–∑–¥–µ:**
   - –í —Ñ–∞–π–ª–µ `.env` –Ω–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö
   - –í –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è Docker
   - –í –ª—é–±—ã—Ö –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞** –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è production
2. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø** –∫ API —á–µ—Ä–µ–∑ firewall
3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
4. **–î–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø—ã** `results.json`
5. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
