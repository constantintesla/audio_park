# Визуализация параметров анализа голоса

## Описание

Отдельный веб-интерфейс для визуализации извлеченных параметров из аудиозаписей с привязкой к исходному аудио. Позволяет визуально увидеть, откуда из записи получены различные параметры.

## Доступ

Интерфейс доступен по адресу: `http://localhost:5000/visualization`

## Возможности

### 1. Просмотр извлеченных параметров
- **Jitter** - вариация периода F0 (извлекается из анализа основной частоты)
- **Shimmer** - вариация амплитуды (извлекается из волновой формы)
- **HNR** - отношение гармоник к шуму (извлекается из спектрограммы)
- **F0 Mean/SD** - средняя и стандартное отклонение основной частоты
- **F0-High** - высшая частота F0 (98-й перцентиль)
- **MPT** - максимальное время фонации (из анализа интенсивности)
- **I-Low** - низшая интенсивность (5-й перцентиль)
- **DSI Score** - индекс тяжести дисфонии

### 2. Интерактивные графики

#### Волновая форма (Waveform)
- Показывает изменение амплитуды сигнала во времени
- Отсюда извлекаются параметры **Shimmer** и **I-Low**
- Поддерживает масштабирование и панорамирование

#### Основная частота (F0 / Pitch)
- Показывает высоту тона голоса во времени
- Отсюда извлекаются параметры **Jitter**, **F0 Mean**, **F0 SD** и **F0-High**
- Отображает среднее значение F0 пунктирной линией

#### Спектрограмма
- Показывает распределение энергии по частотам во времени
- Отсюда извлекается параметр **HNR** и другие спектральные признаки
- Цветовая карта показывает уровень энергии (темнее = больше энергии)

#### Интенсивность сигнала
- Показывает громкость сигнала во времени
- Используется для расчета **MPT** и **I-Low**
- Помогает визуализировать паузы и активную речь

### 3. Сегментация аудио
- Отображение всех сегментов аудио (разбиение по паузам)
- Параметры каждого сегмента отдельно
- Клик по сегменту переходит к соответствующему моменту в аудио

### 4. Аудио плеер
- Воспроизведение обработанного аудио
- Синхронизация с графиками
- Визуализация текущей позиции на waveform

## Использование

1. **Запустите API сервер** (если еще не запущен):
   ```bash
   python start_api.py
   ```

2. **Откройте браузер** и перейдите по адресу:
   ```
   http://localhost:5000/visualization
   ```

3. **Выберите результат анализа** из выпадающего списка

4. **Нажмите "Загрузить визуализацию"**

5. **Изучите графики**:
   - Используйте колесо мыши для масштабирования
   - Перетаскивайте для панорамирования
   - Наводите курсор для просмотра значений

6. **Воспроизведите аудио** для синхронизации с графиками

## Технические детали

### API Эндпоинты

- `GET /api/visualization/<index>` - получение данных визуализации для результата с индексом `<index>`
- `GET /api/audio/<index>` - получение аудиофайла для воспроизведения

### Структура данных

Данные визуализации включают:
- `waveform` - данные волновой формы (время, амплитуда)
- `f0_data` - данные основной частоты (время, значения, среднее)
- `intensity` - данные интенсивности (время, значения)
- `spectrogram` - данные спектрограммы (частоты, времена, амплитуды)
- `segments` - данные сегментов с их параметрами
- `audio_url` - URL для загрузки аудио

### Требования

- Результаты анализа должны содержать сырые данные (`raw_data`)
- Для полной функциональности требуется наличие:
  - `processed_audio.wav` - обработанный аудиофайл
  - `waveform_data.json` - данные waveform
  - `segment_features.json` - параметры сегментов
  - `spectrogram_meta.json` - метаданные спектрограммы

## Примечания

- Для работы F0 и интенсивности требуется библиотека `parselmouth` (Praat)
- Если `parselmouth` недоступен, используется fallback через `librosa`
- Спектрограмма может быть большой, поэтому используется упрощенная визуализация
- Все графики поддерживают интерактивное масштабирование и панорамирование

## Примеры использования

### Анализ Jitter
1. Откройте график F0
2. Обратите внимание на вариацию значений F0 во времени
3. Большая вариация соответствует высокому Jitter

### Анализ Shimmer
1. Откройте график волновой формы
2. Обратите внимание на вариацию амплитуды
3. Большая вариация соответствует высокому Shimmer

### Анализ HNR
1. Откройте спектрограмму
2. Обратите внимание на четкость гармоник (вертикальные линии)
3. Четкие гармоники = высокий HNR, размытые = низкий HNR

### Анализ MPT
1. Откройте график интенсивности
2. Найдите самый длинный непрерывный сегмент с высокой интенсивностью
3. Длительность этого сегмента соответствует MPT